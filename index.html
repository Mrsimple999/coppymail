<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω Email Online - Ch·ªëng Tr√πng & Ch·ªëng Spam</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; transition: background 0.4s; }
textarea, input, button { font-size: 16px; width: 90%; max-width: 340px; margin-top: 10px; padding: 12px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; }
button { background: #007bff; color: white; border: none; cursor: pointer; transition: background 0.3s; }
button:hover { background: #0056b3; }
.input-container { display: flex; gap: 10px; align-items: center; width: 90%; max-width: 340px; margin-top: 10px; }
#manualCopyButton { max-width: 60px; padding: 10px; }
#deleteListButton { background: #dc3545; }
#deleteListButton:hover { background: #a71d2a; }
#copyButton { font-size: 20px; padding: 18px; width: 95%; max-width: 380px; margin-top: 30px; background: #28a745; }
#copyButton:hover { background: #1c7c31; }
</style>
</head>
<body>
<h3>üì® Qu·∫£n l√Ω danh s√°ch Email Online (Ch·ªëng Tr√πng & C·∫£nh B√°o Telegram)</h3>
<textarea id="emailListInput" placeholder="D√°n email, text r√°c, ph√¢n c√°ch b·∫•t k·ª≥"></textarea>
<button id="addListButton">‚ûï Th√™m Email V√†o Danh S√°ch</button>
<button id="deleteListButton">üóëÔ∏è X√≥a Danh S√°ch Email</button>
<div class="input-container">
<input type="text" id="emailOutput" placeholder="Email s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y" readonly>
<button id="manualCopyButton">üìã</button>
</div>
<p id="count"></p>
<p id="output"></p>
<button id="copyButton">üìã L·∫•y & Copy Email</button>
<script>
const firebaseConfig = { /* c·∫•u h√¨nh firebase c·ªßa b·∫°n */ };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const emailRef = db.ref('emails');
const alertsRef = db.ref('alerts');
const telegramBotToken = "YOUR_BOT_TOKEN";
const chatId = "YOUR_CHAT_ID";
const alertThreshold = 10;
function sendTelegramAlert(message) {
    const url = `https://api.telegram.org/bot${telegramBotToken}/sendMessage`;
    fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ chat_id: chatId, text: message }) });
}
function extractEmails(text) {
    const parts = text.split(/[\s,;|]+/);
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    const set = new Set();
    parts.forEach(item => { if (emailRegex.test(item.trim())) set.add(item.trim().toLowerCase()); });
    return Array.from(set);
}
function updateCount(list) {
    document.getElementById('count').textContent = `üìä S·ªë email c√≤n l·∫°i: ${list.length}`;
}
function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
        document.getElementById('output').textContent = `‚úÖ ƒê√£ copy: ${text}`;
    });
}
emailRef.on('value', snapshot => {
    const data = snapshot.val() || [];
    updateCount(data);
});
document.getElementById('addListButton').addEventListener('click', () => {
    const input = document.getElementById('emailListInput').value.trim();
    const filtered = extractEmails(input);
    if (filtered.length === 0) return alert('Kh√¥ng c√≥ email h·ª£p l·ªá');
    emailRef.transaction(current => {
        const updated = current ? current.slice() : [];
        filtered.forEach(email => { if (!updated.includes(email)) updated.push(email); });
        return updated;
    }, () => {
        alertsRef.child('low_mail_alert_sent').set(false);
        document.getElementById('emailListInput').value = '';
    });
});
document.getElementById('deleteListButton').addEventListener('click', () => {
    if (confirm('B·∫°n ch·∫Øc ch·∫Øn x√≥a?')) {
        emailRef.set([]);
        alertsRef.child('low_mail_alert_sent').set(false);
    }
});
document.getElementById('manualCopyButton').addEventListener('click', () => {
    const email = document.getElementById('emailOutput').value;
    if (email) copyText(email);
});
document.getElementById('copyButton').addEventListener('click', () => {
    const btn = document.getElementById('copyButton');
    btn.disabled = true; btn.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
    document.body.style.background = '#17a2b8';
    emailRef.transaction(current => {
        if (current && current.length > 0) {
            const email = current[0];
            current.splice(0, 1);
            document.getElementById('emailOutput').value = email;
            copyText(email);
            return current;
        }
        return current;
    }, (err, committed, snap) => {
        const remaining = snap.val() || [];
        updateCount(remaining);
        if (remaining.length <= alertThreshold) {
            alertsRef.child('low_mail_alert_sent').once('value').then(snap => {
                if (!snap.val()) {
                    sendTelegramAlert(`‚ö†Ô∏è C·∫£nh b√°o: S·ªë email c√≤n l·∫°i d∆∞·ªõi ${alertThreshold}.`);
                    alertsRef.child('low_mail_alert_sent').set(true);
                }
            });
        }
        btn.disabled = false; btn.textContent = 'üìã L·∫•y & Copy Email';
        document.body.style.background = '#f0f2f5';
    });
});
</script>
</body>
</html>
